{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile with personal and financial information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile, matches Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "monthlyBaseSalary": {
          "type": "number",
          "description": "The user's monthly base salary used to calculate hourly rates."
        },
        "currency": {
          "type": "string",
          "description": "The currency symbol for monetary values (e.g., FCFA)."
        },
        "reminders": {
          "type": "object",
          "description": "Settings for time entry reminders.",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether reminders are enabled."
            },
            "time": {
              "type": "string",
              "description": "The time of day for the reminder (e.g., '17:00')."
            }
          },
          "required": ["enabled", "time"]
        },
        "workplace": {
          "type": "object",
          "description": "Geofence for the user's primary workplace.",
          "properties": {
            "latitude": {
              "type": "number"
            },
            "longitude": {
              "type": "number"
            },
            "radius": {
              "type": "number",
              "description": "Radius of the geofence in meters."
            }
          }
        }
      },
      "required": ["id", "email", "name", "monthlyBaseSalary", "currency", "reminders"]
    },
    "TimeEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TimeEntry",
      "type": "object",
      "description": "Represents a single time entry record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the time entry."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N TimeEntry)"
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the time entry.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the time entry.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "Geolocation data associated with the time entry."
        },
        "notes": {
          "type": "string",
          "description": "Optional notes associated with the time entry."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "startTime",
        "endTime"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a generated report of time entries.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the report."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Report)"
        },
        "reportType": {
          "type": "string",
          "description": "The type of report (daily, weekly, monthly)."
        },
        "startDate": {
          "type": "string",
          "description": "The start date for the report period.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date for the report period.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "The report content (e.g., JSON, CSV, text)."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "reportType",
        "startDate",
        "endDate",
        "content"
      ]
    },
    "Team": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Team",
      "type": "object",
      "description": "Represents a team of users for data sharing and summarization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the team."
        },
        "name": {
          "type": "string",
          "description": "The name of the team."
        },
        "memberIds": {
          "type": "array",
          "description": "References to UserProfiles. (Relationship: Team N:N UserProfile)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Reminder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reminder",
      "type": "object",
      "description": "Represents a reminder for time entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reminder."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Reminder)"
        },
        "reminderTime": {
          "type": "string",
          "description": "The time the reminder should trigger.",
          "format": "date-time"
        },
        "message": {
          "type": "string",
          "description": "The message to display in the reminder."
        },
        "recurrence": {
          "type": "string",
          "description": "Recurrence pattern of the reminder (e.g., daily, weekly)."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "reminderTime",
        "message"
      ]
    }
  },
  "auth": {
    "providers": [
      "email-password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Each user has their own profile document. Authorization is based on the `userId` path parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            },
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile, can be same as userId."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/timeEntries/{timeEntryId}",
        "definition": {
          "entityName": "TimeEntry",
          "schema": {
            "$ref": "#/backend/entities/TimeEntry"
          },
          "description": "Stores time entry records for each user. Includes denormalized 'userProfileId' to maintain authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            },
            {
              "name": "timeEntryId",
              "description": "The unique identifier for the time entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Stores reports generated for each user. Includes denormalized 'userProfileId' to maintain authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            },
            {
              "name": "reportId",
              "description": "The unique identifier for the report."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reminders/{reminderId}",
        "definition": {
          "entityName": "Reminder",
          "schema": {
            "$ref": "#/backend/entities/Reminder"
          },
          "description": "Stores reminders for each user. Includes denormalized 'userProfileId' to maintain authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            },
            {
              "name": "reminderId",
              "description": "The unique identifier for the reminder."
            }
          ]
        }
      },
      {
        "path": "/teams/{teamId}",
        "definition": {
          "entityName": "Team",
          "schema": {
            "$ref": "#/backend/entities/Team"
          },
          "description": "Stores team information.  The 'memberIds' array contains a list of user IDs who are members of the team.",
          "params": [
            {
              "name": "teamId",
              "description": "The unique identifier for the team."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure data consistency, security, and scalability for the OM Suivi application, while adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs.  The primary strategy is to leverage path-based ownership and denormalization to avoid complex security rules that rely on `get()` calls. The structure also uses Structural Segregation to enforce a homogeneous security posture within each collection. For entities directly owned by users (TimeEntry, Report, Reminder), a hierarchical path structure under `/users/{userId}` is employed. Teams utilize a subcollection under `/teams/{teamId}`. To ensure authorization independence, the UserProfile id is denormalized into the TimeEntry, Report and Reminder documents under the user's collection, removing any need for rules to 'get()' the user profile. This approach also simplifies querying and reporting, as all necessary data for a user is co-located. QAPs are supported by using the structure defined below, allowing list operations to be secure using the security rules based on path and user id."
  }
}
